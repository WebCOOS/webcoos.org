This file was generated by the [generator-axds-landing-page](generator-axds-landing-page) Yeoman
generator. To make improvements this starter site, please contribute to that project.

# webcoos-project-site

The project website for WebCOOS

## Configuration

The following environment variables are configured for `webcoos-project-site`:

*   `NEXT_PUBLIC_MAPBOX_TOKEN`, for Mapbox.

*   `STORYBOOK_MAPBOX_TOKEN`, for Storybook.

*   `NEXT_PUBLIC_WEBCOOS_API_TOKEN`, for accessing the WebCOOS API during build
    and runtime.

An example `.env.template` is available, with contents like the following:

```shell
STORYBOOK_MAPBOX_TOKEN=
NEXT_PUBLIC_MAPBOX_TOKEN=

STORYBOOK_WEBCOOS_API_TOKEN=
NEXT_PUBLIC_WEBCOOS_API_TOKEN=ENTER_THIS_TOKEN_TO_BE_ABLE_TO_BUILD
NEXT_PUBLIC_WEBCOOS_API_URL=https://app.stage.webcoos.org/webcoos/api
```

The easiest way to configure the application is to:

1.  Copy the `.env.template` to `.env`:

    `cp .env.template .env`

1.  ...and edit the variables.

Alternatively, you can manually set the config items in your environment, or in
an `.envrc` that updates your environment upon `cd`-ing into the
`webcoos-project-site` directory.

**NOTE**: Without the `NEXT_PUBLIC_WEBCOOS_API_TOKEN`, you will not be able to
build (`npm run build`) or run (`npm run dev`) the project. This is by design as
the `webcoos-project-site` requires assets provided by the API in order to build
camera pages ahead of deployment.

If you see errors regarding the `NEXT_PUBLIC_WEBCOOS_API_TOKEN` environment
variable being unset, you will either need to do one of the following to
support your application build.

*   Set the `NEXT_PUBLIC_WEBCOOS_API_TOKEN` in your `.env` file to a valid
    token as provided by the targeted WebCOOS API environment (for example,
    `NEXT_PUBLIC_WEBCOOS_API_URL=https://app.stage.webcoos.org/webcoos/api` to
    target the stage environment).

*   Set `NEXT_PUBLIC_WEBCOOS_API_TOKEN` before your call to `npm run build`

    ```shell
    export NEXT_PUBLIC_WEBCOOS_API_TOKEN=abc123 npm run build
    ```

If you are building using `docker`, and are also using `docker compose`, you can
use the following to configure the build. This will read the env var values from
the `.env` file, and use them as build args:

```shell
docker compose build
```

You'll also need a Mapbox token to see the camera map components. Export
`NEXT_PUBLIC_MAPBOX_TOKEN` in your shell before starting the development server
or building the static site. Consider setting this in your `.env`.

Set the same value to `STORYBOOK_MAPBOX_TOKEN` if you want to see map components
in Storybook.

You'll also need a WebCOOS API token.  Set this in
`NEXT_PUBLIC_WEBCOOS_API_TOKEN` and `STORYBOOK_WEBCOOS_API_TOKEN`.

These values for these can be found in the GitLab CI secrets.

#### Optional: Google Analytics

The build process by default sets `NEXT_PUBLIC_GOOGLE_ANALYTICS_MEASUREMENT_ID`
during build and deploy.

You likely will not need to set this locally.  The script tags are emitted when
this env var is present.

## Development

### Requirements

This project was originally built against Node.js v16.x, but has been
upgraded to use v18.x


## Setup

[Add the AXDS NPM registry](https://axds.atlassian.net/wiki/spaces/LEM/pages/1027833857/2022-01-18+adding+axds+npm+package+registry) to `npm`

```shell
npm config set @axds:registry http://npm-registry.srv.axiomptk/
```

```shell
npm install
```

### Running

To run the development server:

```shell
npm run dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

In development mode, changes to React components will be hot reloaded. Changes to configuration
or data source files may require a restart to be picked up.

To test the static site generation:

```shell
npm run build
```

And to serve the result:

```shell
npm start
```

### Update Visual Theme

The file `tailwind.config.js` defines the visual theme of the site. At a minimum you should
specify `primary` and `secondary` colors, each with lighter and darker variants.

### Updating Site Metadata

The file `site.yaml` contains site-wide metadata. Go here to change the header, footer, and
other site-wide metadata.

### Adding Pages

There are two ways to add pages. Simple pages just render the content of a Markdown file. More
complex pages can be implemented as custom React components.

#### Adding a Markdown page

If the content of a page can be fully described by Markdown (i.e. no custom components), add
that file to the `md-content` directory. The structure of files and subdirectories in
`md-content` determines the resulting page routes. For example `md-content/about.md` will be
served on `http://example.org/about/`, and `md-content/about/more.md` will be served on
`http://example.org/about/more/`. Note that a file with the name `index.md` does **not** have
any special significance.

#### Adding a Custom Page

If the content of a page is more complex than can be described by a Markdown file, add
a new Javascript file in the `pages` directory. The file should have a default export that
is a React component. It may also export an `async` function called `getStaticProps` which
allow it to read data from an external source. See the
[Next.js documentation](https://nextjs.org/docs/basic-features/pages) for more information.

Like Markdown content, the structure of the files and subdirectories determine the resulting
routes. However in this case files with the name `index.js` **do** have special significance.
See the [Next.js routing documentation](https://nextjs.org/docs/routing/introduction) for details.

When it makes sense, consider extracting client-configurable content into a `.yaml` file which
is loaded by your page. This makes it easier for non-developers to update content. The default home
page (`src/index.js`) is an example of this. It loads some configuration from `home.yaml`.

React components that do not represent specific pages can be added to the `componenets` directory.

### Adding Static Assets

Static asset files (e.g. images, downloadable files) should be placed in the `public` directory.
These files will be served from the root path of your site. They can be then be referenced in
custom React components, Markdown files, and YAML files. For example, the file `public/logo.png`
will be available as `http://example.org/logo.png`. For more information and caveats, see
the [Next.js static file documentation](https://nextjs.org/docs/basic-features/static-file-serving).

**It is not required, but highly encouraged to add a `favicon.ico` file to the root of the `public`
directory**. If you want to get [fancier](https://bitsofco.de/all-about-favicons-and-touch-icons/)
with [favicons](https://github.com/audreyfeldroy/favicon-cheat-sheet), add them to the `public`
directory as well, and add the appropriate tags to `components/Page.js`.

### Integrating Sphinx Documentation

By default, a `/docs` route is included for rendering documentation generated by
[Sphinx](https://www.sphinx-doc.org/en/master/).

If this is not required for your site, you can safely delete `pages/docs`.

If you do want to integrate Sphinx documentation, you must first generate the documentation
as JSON and then copy it into this project. The `bin/copy-docs` script is provided to help
with the second step.

In your documentation project, generate JSON output:

```shell
sphinx-build -b json sourcedir builddir
```

In this project root:

```shell
./bin/copy-docs /absolute/path/to/builddir docs
```

The last argument is a destination directory relative to this project root. If you choose
something other than `docs`, you need to also rename the `pages/docs` subdirectory and update
the `DOCS_DIR` variable in `pages/docs/[[...slug]].js`.

## Learn More

To learn more about Next.js, take a look at the following resources:

-   [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
-   [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.
